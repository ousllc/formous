(function(S,E){typeof exports=="object"&&typeof module<"u"?E(exports):typeof define=="function"&&define.amd?define(["exports"],E):(S=typeof globalThis<"u"?globalThis:S||self,E(S.Formous={}))})(this,function(S){"use strict";const w={...{required:{validate:(e,t)=>{var a;return!(t.hasAttribute("required")||((a=t.getAttribute("data-validation"))==null?void 0:a.includes("required")))||e.trim().length>0},message:()=>"This field is required."},email:{validate:e=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e),message:()=>"Please enter a valid email address."},numeric:{validate:e=>/^[0-9]+$/.test(e),message:()=>"Please enter a valid number."},alphanumeric:{validate:e=>/^[a-zA-Z0-9]+$/.test(e),message:()=>"Please enter only letters and numbers."},minLength:{validate:(e,t)=>{const r=t.getAttribute("minlength");return!r||e.length>=parseInt(r)},message:e=>`Minimum length is ${e.getAttribute("minlength")}`},maxLength:{validate:(e,t)=>{const r=t.getAttribute("maxlength");return r?e.length<=Number(r):!0},message:e=>`Please enter no more than ${e.getAttribute("maxlength")} characters`},min:{validate:(e,t)=>{const r=t.getAttribute("min");if(!r)return!0;const a=Number(e);return!isNaN(a)&&a>=Number(r)},message:e=>`Please enter a value greater than or equal to ${e.getAttribute("min")}`},max:{validate:(e,t)=>{const r=t.getAttribute("max");if(!r)return!0;const a=Number(e);return!isNaN(a)&&a<=Number(r)},message:e=>`Please enter a value less than or equal to ${e.getAttribute("max")}`},pattern:{validate:(e,t)=>{const r=t.getAttribute("data-pattern");return r?new RegExp(r).test(e):!0},message:e=>`Please match the requested format: ${e.getAttribute("data-pattern")}.`},url:{validate:e=>/^(https?:\/\/)?([\w\-]+)+([\w\-.]+)+(:\d+)?(\/[\w\-]*)*(\?[\w\-=&]*)?(#[\w\-]*)?$/.test(e),message:()=>"Please enter a valid URL."},date:{validate:e=>!isNaN(Date.parse(e)),message:()=>"Please enter a valid date."},time:{validate:e=>/^([01]?[0-9]|2[0-3]):[0-5][0-9]$/.test(e),message:()=>"Please enter a valid time in HH:MM format."},phone:{validate:e=>/^\+?[0-9\- ]{7,15}$/.test(e),message:()=>"Please enter a valid phone number."},postalCode:{validate:e=>/^[0-9]{3}-?[0-9]{4}$/.test(e),message:()=>"Please enter a valid postal code."},equals:{validate:(e,t)=>{const r=t.getAttribute("data-equals"),a=r?document.getElementById(r):null;return a?e===a.value:!0},message:()=>"Values do not match."},checkboxRequired:{validate:(e,t)=>t.checked,message:()=>"This checkbox is required."},fileRequired:{validate:(e,t)=>{const r=t.files;return r!==null&&r.length>0},message:()=>"Please upload a file."},accepted:{validate:e=>["yes","on","1","true"].includes(e.toLowerCase()),message:()=>"This field must be accepted."},json:{validate:e=>{try{return JSON.parse(e),!0}catch{return!1}},message:()=>"Please enter a valid JSON string."},"checkbox-group":{validate:(e,t)=>{const r=t.closest('fieldset[data-validation="checkbox-group"]');if(!r)return!0;const a=r.querySelectorAll('input[type="checkbox"]'),s=parseInt(r.getAttribute("data-group-min")||"0",10),i=r.getAttribute("data-group-max")?parseInt(r.getAttribute("data-group-max")||"0",10):a.length,n=Array.from(a).filter(d=>d.checked).length;return!r.getAttribute("data-group-min")&&n>i||!r.getAttribute("data-group-max")&&n<s?!1:n>=s&&n<=i},message:e=>{const t=e.closest('fieldset[data-validation="checkbox-group"]'),r=(t==null?void 0:t.getAttribute("data-group-min"))||"0",a=(t==null?void 0:t.getAttribute("data-group-max"))||"∞";return t!=null&&t.getAttribute("data-group-min")?t!=null&&t.getAttribute("data-group-max")?`Please select between ${r} and ${a} options.`:`Please select at least ${r} options.`:`Please select at most ${a} options.`}},"confirm-email":{validate:(e,t)=>{var a;const r=(a=t.form)==null?void 0:a.querySelector('input[data-validation~="email"]');return!r||!r.value?!0:e===r.value},message:()=>"Email addresses do not match."},password:{validate:(e,t,r)=>{var f;const a=((f=r==null?void 0:r.validationPatterns)==null?void 0:f.password)||{},s=a.minLength??8,i=a.maxLength??100,n=a.requireUppercase??!0,d=a.requireNumber??!0,l=a.requireSymbol??!0;return!(e.length<s||e.length>i||n&&!/[A-Z]/.test(e)||d&&!/\d/.test(e)||l&&!/[!@#$%^&*]/.test(e))},message:(e,t)=>{var f;const r=((f=t==null?void 0:t.validationPatterns)==null?void 0:f.password)||{},a=r.minLength??8,s=r.maxLength??100,i=r.requireUppercase??!0,n=r.requireNumber??!0,d=r.requireSymbol??!0,l=[];return l.push(`at least ${a} characters${s!==100?`, maximum ${s} characters`:""}`),i&&l.push("uppercase letter"),n&&l.push("number"),d&&l.push("special character (!@#$%^&*)"),`Password must contain ${l.join(", ")}`}}}};function C(e){Object.assign(w,e)}function q(e,t,r=!1){var o,y;const a=e.closest("fieldset[data-validation]");let s=!0,i={};const n=[{attr:"required",type:"required"},{attr:"min",type:"min"},{attr:"max",type:"max"},{attr:"minlength",type:"minLength"},{attr:"maxlength",type:"maxLength"}];if(e.type==="email"){const c=w.email;c&&!c.validate(e.value,e)&&(i.email=c.message(e),s=!1)}n.forEach(c=>{var u;if(e.hasAttribute(c.attr)){const m=w[c.type];if(m&&!m.validate(e.value,e)){const x=(u=t==null?void 0:t.validationMessages)==null?void 0:u[c.type],L=typeof m.message=="function"?m.message(e):m.message;i[c.type]=x||L,s=!1}}}),(a?((o=a.getAttribute("data-validation"))==null?void 0:o.split(" "))||[]:((y=e.getAttribute("data-validation"))==null?void 0:y.split(" "))||[]).forEach(c=>{const u=w[c];u&&(u.validate(e.value,e,t)||(i[c]=u.message(e,t),s=!1))});const l=a||e.closest("div");if(l){const c=l.querySelectorAll('[data-validation="error"]');R(c,i,e,t)}const f=e.getAttribute("name");if(f){const c=document.querySelectorAll(`[data-validation="error"][data-validation-for="${f}"]`),u=document.querySelector("[data-validation-error-global]");(r||u!=null&&u.classList.contains("active"))&&R(c,i,e,t);const m=Array.from(c).some(x=>x.style.display==="block");u==null||u.classList.toggle("active",m)}return s}function N(e,t,r,a){var n,d,l;if(console.log("Debug getErrorMessage:",{type:e,errorsByType:r,hasError:r[e],options:a,validationMessages:a==null?void 0:a.validationMessages,optionMessage:(n=a==null?void 0:a.validationMessages)==null?void 0:n[e]}),!r[e])return"";const s=(d=t.closest("div"))==null?void 0:d.querySelector(`[data-validation-type="${e}"]`);if(s!=null&&s.hasAttribute("data-error-fixed"))return console.log("Using fixed message:",s.innerHTML),s.innerHTML;const i=(l=a==null?void 0:a.validationMessages)==null?void 0:l[e];if(i){if(console.log("Using option message:",i),typeof i=="function"){const f=i(t);return console.log("Function message result:",f),f}return i}return console.log("Using default message:",r[e]),r[e]}function R(e,t,r,a){const s=e.length===1,i=Object.keys(t).length>0;e.forEach(n=>{var y,c;const d=n.getAttribute("data-validation-type"),l=n,f=l.innerHTML.trim(),o=l.hasAttribute("data-error-fixed");if(d){const u=N(d,r,t,a);if(o){l.style.display=t[d]?"block":"none";return}((y=a==null?void 0:a.validationMessages)==null?void 0:y[d])?l.innerHTML=u:f||(l.innerHTML=u),l.style.display=t[d]?"block":"none"}else if(s){const u=Object.keys(t)[0],m=N(u,r,t,a);o||((c=a==null?void 0:a.validationMessages)!=null&&c[u]||!f)&&(l.innerHTML=m),l.style.display=i?"block":"none"}})}function k(e,t={}){const{offset:r=50,behavior:a="smooth",duration:s="0.5s"}=t;document.documentElement.style.setProperty("scroll-behavior",a),document.documentElement.style.setProperty("transition-duration",s),document.documentElement.style.setProperty("scroll-timeline-name","scroll"),e.style.scrollMargin=`${r}px`,e.scrollIntoView({behavior:a,block:"nearest",inline:"nearest"}),setTimeout(()=>{document.documentElement.style.removeProperty("scroll-behavior"),document.documentElement.style.removeProperty("transition-duration"),document.documentElement.style.removeProperty("scroll-timeline-name"),setTimeout(()=>{e.focus()},2e3)},parseFloat(s)*1e3)}function V(e,t){const r=e.querySelectorAll("input, textarea, select");let a=!0,s=null;return r.forEach(i=>{q(i,t,!0)||(a=!1,s||(s=i))}),!a&&s&&setTimeout(()=>{s&&k(s,t.scrollOptions)},0),a}function O(e,t=!1,r){const{progressFillSelector:a="#progress-fill",indicatorSelector:s=".step-indicator",progressSelector:i="#step-progress"}=(r==null?void 0:r.stepOptions)||{};let n=Array.from(e.querySelectorAll(".step"));const d=e.querySelector(a),l=e.querySelectorAll(s),f=e.querySelector(i);let o=0;const y=v=>{const g=e.querySelector('.step[data-confirmation="true"]');if(!g)return;g.querySelectorAll("[data-confirm]").forEach(b=>{var P,$;const p=b.getAttribute("data-confirm");if(!p)return;if((P=e.querySelector(`fieldset input[name="${p}"]`))==null?void 0:P.closest("fieldset")){const M=e.querySelectorAll(`input[name="${p}"]:checked`),U=Array.from(M).map(W=>{const F=W.nextElementSibling;return(F==null?void 0:F.textContent)||""}).filter(Boolean),D=(($=v.confirmationOptions)==null?void 0:$.delimiter)||",";b.textContent=U.join(D)}else{const M=e.querySelector(`[name="${p}"]`);M?b.textContent=M.value||"未入力":b.textContent="未入力"}})},c=()=>{const v=(o+1)/n.length*100;d&&(d.style.width=`${v}%`),l.forEach((g,h)=>{g.classList.toggle("active",h<=o)}),f&&(f.textContent=`Step ${o+1}/${n.length}`)},u=()=>{const g=n[o].querySelectorAll('input, textarea, select, [contenteditable="true"], button[role="combobox"], div[role="listbox"], div[role="slider"], div[role="spinbutton"]');let h=!0;return g.forEach(b=>{q(b,r)||(h=!1)}),h},m=v=>{n.forEach((P,$)=>P.classList.toggle("active",$===v)),o=v,c();const g=e.querySelector("[data-step-current]"),h=e.querySelector("[data-step-total]");g&&(g.textContent=String(o+1)),h&&(h.textContent=String(n.length));const b=n[o],p=b.querySelector('[data-action="next"]'),A=b.querySelector('[data-action="confirm"]');t&&o===n.length-2?(p&&(p.style.display="none"),A&&(A.style.display="inline-block")):(p&&(p.style.display="inline-block"),A&&(A.style.display="none")),t&&o===n.length-1&&y(r||{formSelector:"#step-form",confirmationOptions:{delimiter:"、"}})},x=()=>{if(!u()){const h=n[o].querySelector("input:invalid, textarea:invalid, select:invalid");h&&k(h,r==null?void 0:r.scrollOptions);return}o<n.length-1&&m(o+1)},L=()=>{o>0&&m(o-1)},H=v=>{v>o&&!u()||m(v)};return m(o),e.addEventListener("click",v=>{const g=v.target;if(g.hasAttribute("data-action")){const h=g.getAttribute("data-action");if(h==="next"||h==="confirm")x();else if(h==="previous")L();else if(h==="edit"){const b=parseInt(g.getAttribute("data-target-step")||"1")-1;m(b)}}}),l.forEach((v,g)=>{v.addEventListener("click",()=>H(g))}),{showStep:m,handleNext:x,handlePrevious:L,updateProgressBar:c,updateConfirmationPage:y}}const j={required:{message:"This field is required"}}.required;console.log(`Custom rule found: ${j.message}`),typeof window<"u"&&(window.Webflow=window.Webflow||[]);const I=e=>{if(e.enableWebflow){window.Webflow.push(()=>{T(e)});return}return T(e)};function T(e){const t=document.querySelector(e.formSelector);if(!t){console.error("Form not found");return}return e.customRules&&C(e.customRules),t.querySelectorAll("input, textarea, select").forEach(a=>{a.addEventListener("input",()=>q(a,e,!1)),a.addEventListener("blur",()=>q(a,e,!1))}),e.enableWebflow&&(t.setAttribute("novalidate","true"),t.querySelectorAll('[data-validation="error"]').forEach(a=>{a.style.display="none"})),t.addEventListener("submit",async a=>{if(e.enableWebflow){if(!V(t,e)){a.preventDefault(),a.stopPropagation();return}return}if(a.preventDefault(),!V(t,e)){const n=t.querySelector("input:invalid, textarea:invalid, select:invalid");n&&k(n,e.scrollOptions);return}const i=new FormData(t);try{"onSubmit"in e&&await e.onSubmit(i)}catch(n){console.error("Error:",n)}}),e.enableConfirmationPage?O(t,!0,e):{validateForm:()=>V(t,e),validateField:a=>q(a,e)}}typeof window<"u"&&(window.Formous=I),S.Formous=I,Object.defineProperty(S,Symbol.toStringTag,{value:"Module"})});
